---
import Layout from '../../../layouts/Layout.astro';
import MenuDisplay from '../../../components/MenuDisplay.astro';
import CartSummary from '../../../components/CartSummary.astro';
import FloatingCartIndicator from '../../../components/FloatingCartIndicator.astro';
import NotFound from '../../../components/NotFound.astro';
import NetworkError from '../../../components/NetworkError.astro';
import EmptyMenu from '../../../components/EmptyMenu.astro';

const { restaurant_code, table_code } = Astro.params;

// Validate required parameters
if (!restaurant_code || !table_code) {
  return Astro.redirect('/');
}

const pageTitle = `Menu - ${restaurant_code} - ${table_code}`;
---

<Layout title={pageTitle}>
  <!-- Menu will be loaded client-side -->
  <MenuDisplay />

  <!-- Cart Summary (Fixed at bottom on mobile, inline on desktop) -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 md:relative md:border-t-0 md:bg-transparent md:p-0 mt-8 z-30">
    <div class="max-w-md mx-auto">
      <CartSummary 
        showSpecialRequests={true}
        showCheckoutButton={true}
        className="md:shadow-sm"
      />
    </div>
  </div>

  <!-- Floating Cart Indicator (shows when cart has items) -->
  <FloatingCartIndicator position="bottom-right" />

  <!-- Spacer for fixed cart summary on mobile -->
  <div class="h-60 md:hidden"></div>

  <!-- Load menu display script with restaurant and table codes -->
  <script define:vars={{ restaurant_code, table_code }}>
    // Pass restaurant and table codes to the client
    window.menuPageData = {
      restaurantCode: restaurant_code,
      tableCode: table_code
    };

    Promise.all([
      import('../../../scripts/menu-display.js'),
      import('../../../scripts/performance-monitor.js')
    ]).then(() => {
      // Menu display and performance monitoring are automatically initialized
    }).catch(() => {
      // Graceful fallback if scripts fail to load
      console.warn('Failed to load performance scripts');
    });
  </script>
</Layout>
